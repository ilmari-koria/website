<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
                version="2.0">

<xsl:param name="org-path"/>

<xsl:template match="/">
<xsl:text>
  (require 'package)
  (package-initialize)
  (unless (package-installed-p 'dash)
    (package-refresh-contents)
    (package-install 'dash))
  (unless (package-installed-p 's)
    (package-refresh-contents)
    (package-install 's))
  (add-to-list 'load-path ".")
  (require 'org-ml)
  (require 'om-to-xml)
</xsl:text>

<xsl:text>
  (defun convert-blog-posts-to-xml ()
</xsl:text>

<xsl:text>
  (let ((directory
</xsl:text>

<xsl:value-of select="$org-path"/>

<xsl:text>
  ))
  (when (file-directory-p directory)
    (dolist (file (directory-files directory t "\\.org$"))
      (when (file-regular-p file)
        (with-current-buffer (find-file-noselect file)
          (om-to-xml)
          (save-buffer)
          (kill-buffer)))))))
</xsl:text>

</xsl:template>
